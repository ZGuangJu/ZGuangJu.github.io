(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{657:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("npm i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("g pm2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//or")]),a._v("\nyarn global add pm2\n")])])]),t("ul",[t("li",[a._v("安装最新版")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("npm install pm2 @ latest "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("g\n")])])]),t("ul",[t("li",[a._v("启动"),t("code",[a._v("app.js")]),a._v("应用程序")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 start app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js\n")])])]),t("ul",[t("li",[a._v("启动"),t("code",[a._v("vue")]),a._v("项目")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 start npm "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" run serve\n\n")])])]),t("ul",[t("li",[a._v("添加变量启动程序("),t("code",[a._v("esay-mock")]),a._v("，生产模式启动)")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("production pm2 start app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js\n")])])]),t("ul",[t("li",[a._v("启动(4个应用程序会自动进行负载均衡)")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 start app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("i "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//后台运行pm2，启动4个app.js")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("启动时的参数介绍")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定应用名称")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("app_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 热更新 文件更改时监听并重新启动应用")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("watch\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置应用重新加载的内存阈值")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("memory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("restart "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v("MB"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定日志文件")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("log "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("log_path"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 将额外的参数传递给脚本")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" arg1 arg2 arg3\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 自动重启之间的延迟")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("delay "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("delay "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" ms"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 带时间的前缀日志")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("time\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 不要自动重启应用")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("autorestart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 指定cron以强制重启")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("cron "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("cron_pattern"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 附加到应用程序日志")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("daemon\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 进程数/集群数")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("i "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n")])])])]),a._v(" "),t("ul",[t("li",[a._v("监视每个 "),t("code",[a._v("node")]),a._v(" 进程的 "),t("code",[a._v("CPU")]),a._v(" 和内存的使用情况")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 monit\n")])])]),t("ul",[t("li",[a._v("当文件变化时自动重启应用")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 start app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js –watch\n")])])]),t("ul",[t("li",[t("code",[a._v("pm2")]),a._v(" 启动的所有的应用程序列表")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 list\n")])])]),t("ul",[t("li",[a._v("显示应用程序的所有信息")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 show "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("ul",[t("li",[a._v("停止")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 stop     "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("app_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'all'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("json_conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("ul",[t("li",[a._v("停止所有的应用程序")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 stop all\n")])])]),t("ul",[t("li",[a._v("重启")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 restart  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("app_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'all'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("json_conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("ul",[t("li",[a._v("重启所有应用")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 restart all\n")])])]),t("ul",[t("li",[a._v("关闭")])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 del  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("app_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("namespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'all'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("json_conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("ul",[t("li",[a._v("零停机重载")])]),a._v(" "),t("p",[a._v("热重装允许更新应用程序而不会造成任何停机：")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 reload all\n")])])]),t("ul",[t("li",[a._v("更新后，保存进程列表，退出旧的"),t("code",[a._v("pm2")]),a._v("并恢复所有进程")])]),a._v(" "),t("p",[t("code",[a._v("pm2")]),a._v("更新是无缝的")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("pm2 update\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);